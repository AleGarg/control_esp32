<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="control.png" type="image/x-icon">
    <link rel="stylesheet" href="style.css">
    <title>Control Remoto</title>
    <script src="script.js" defer></script> <!-- Carga diferida del script -->
</head>
<body id='bodype'>
    <div class="datos">
        <p id='valor_concatenado'>Aquí aparecerá el valor concatenado.</p>
    </div>
    
    <form method="post" action="">
        <input type="text" name="data" required>
        <button type="submit" name="accion" value="Atender">ENVIAR DATA TIO</button>
    </form>

    <div class="video-container">
        <iframe id="twitch-stream" src="" allow="autoplay; fullscreen"></iframe>
    </div>

    <script>
        // Función para realizar la solicitud AJAX
        function cargarDatos() {
            fetch('control_esp32.php') // Cambia la URL según sea necesario
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Error en la red');
                    }
                    return response.json();
                })
                .then(data => {
                    // Manejo de los datos recibidos
                    document.getElementById('valor_concatenado').innerText = data.valor_concatenado;

                    var iframe = document.getElementById("twitch-stream");

                    // Cambiar src del iframe si el valor es 8
                    if (data.valor_concatenado === '8') {
                        iframe.src = "https://player.twitch.tv/?channel=rubius&parent=localhost&autoplay=true";
                    }
                    else if (data.valor_concatenado === "69") {
                    // <iframe width="1366" height="480" src="https://www.youtube.com/embed/cpLrWyAaC_U" title="Gol de Juan Fernando Quintero en la final de la Copa Libertadores" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
                    
                    iframe.src = "https://www.youtube.com/embed/cpLrWyAaC_U";
                    iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share";
                    iframe.referrerpolicy="strict-origin-when-cross-origin";
                    iframe.setAttribute('allowFullScreen', '')
                    }
                    else{
                        iframe.src = "";
                    }
                })
                .catch(error => {
                    console.error('Error al cargar los datos:', error);
                });
        }

        // Llamar a la función para cargar datos cada X segundos
        setInterval(cargarDatos, 10); // Cada segundo
    </script>
</body>
</html>
